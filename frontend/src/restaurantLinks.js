/**
 * Website and app store links by chain. Used for deal action modal.
 * Add more as needed; missing chains will still show Directions when coords exist.
 */
export const RESTAURANT_LINKS = {
  "McDonald's": {
    website: "https://www.mcdonalds.com/us/en-us.html",
    appStore: "https://apps.apple.com/app/mcdonalds/id922103212",
    playStore: "https://play.google.com/store/apps/details?id=com.mcdonalds.mobileapp",
  },
  "Taco Bell": {
    website: "https://www.tacobell.com",
    appStore: "https://apps.apple.com/app/taco-bell-fast-food-delivery/id497387361",
    playStore: "https://play.google.com/store/apps/details?id=com.tacobell.ordering",
  },
  "Chipotle": {
    website: "https://www.chipotle.com",
    appStore: "https://apps.apple.com/app/chipotle/id297811961",
    playStore: "https://play.google.com/store/apps/details?id=com.chipotle.ordering",
  },
  "Wendy's": {
    website: "https://www.wendys.com",
    appStore: "https://apps.apple.com/app/wendys/id540518599",
    playStore: "https://play.google.com/store/apps/details?id=com.wendys",
  },
  "Burger King": {
    website: "https://www.bk.com",
    appStore: "https://apps.apple.com/app/burger-king-app/id638323895",
    playStore: "https://play.google.com/store/apps/details?id=com.bk.mobile",
  },
  "Chick-fil-A": {
    website: "https://www.chick-fil-a.com",
    appStore: "https://apps.apple.com/app/chick-fil-a/id488818252",
    playStore: "https://play.google.com/store/apps/details?id=com.chickfila.cfaflagship",
  },
  "Panda Express": {
    website: "https://www.pandaexpress.com",
    appStore: "https://apps.apple.com/app/panda-express/id528582801",
    playStore: "https://play.google.com/store/apps/details?id=com.pandaexpress.ordering",
  },
  "Subway": {
    website: "https://www.subway.com",
    appStore: "https://apps.apple.com/app/subway/id327254683",
    playStore: "https://play.google.com/store/apps/details?id=com.subway.mobile",
  },
  "Domino's": {
    website: "https://www.dominos.com",
    appStore: "https://apps.apple.com/app/dominos-pizza/id321708914",
    playStore: "https://play.google.com/store/apps/details?id=com.dominos.us",
  },
  "Papa John's": {
    website: "https://www.papajohns.com",
  },
  "Little Caesars": {
    website: "https://www.littlecaesars.com",
    appStore: "https://apps.apple.com/app/little-caesars/id415631954",
    playStore: "https://play.google.com/store/apps/details?id=com.littlecaesars.android",
  },
  "Pizza Hut": {
    website: "https://www.pizzahut.com",
    appStore: "https://apps.apple.com/app/pizza-hut-delivery-takeout/id321560858",
    playStore: "https://play.google.com/store/apps/details?id=com.yum.pizzahut",
  },
  "Olive Garden": {
    website: "https://www.olivegarden.com",
    appStore: "https://apps.apple.com/app/olive-garden-italian-kitchen/id1067313166",
    playStore: "https://play.google.com/store/apps/details?id=com.darden.mobile.olivegarden",
  },
  "Buffalo Wild Wings": {
    website: "https://www.buffalowildwings.com",
    appStore: "https://apps.apple.com/app/buffalo-wild-wings/id1031364004",
    playStore: "https://play.google.com/store/apps/details?id=com.buffalowildwings.consumer",
  },
  "Dunkin'": {
    website: "https://www.dunkindonuts.com",
    appStore: "https://apps.apple.com/app/dunkin/id1056813463",
    playStore: "https://play.google.com/store/apps/details?id=com.dunkin.android",
  },
  "Starbucks": {
    website: "https://www.starbucks.com",
    appStore: "https://apps.apple.com/app/starbucks/id331177714",
    playStore: "https://play.google.com/store/apps/details?id=com.starbucks.mobilecard",
  },
  "Sonic": {
    website: "https://www.sonicdrivein.com",
    appStore: "https://apps.apple.com/app/sonic/id443752621",
    playStore: "https://play.google.com/store/apps/details?id=com.sonicdrivein.sonic",
  },
  "Arby's": {
    website: "https://www.arbys.com",
    appStore: "https://apps.apple.com/app/arbys-fast-food-sandwiches/id1348507359",
    playStore: "https://play.google.com/store/apps/details?id=com.arbys.arbys",
  },
  "Jack in the Box": {
    website: "https://www.jackinthebox.com",
    appStore: "https://apps.apple.com/app/jack-in-the-box-order-app/id1283768751",
    playStore: "https://play.google.com/store/apps/details?id=com.jackinthebox.android",
  },
  "Whataburger": {
    website: "https://www.whataburger.com",
    appStore: "https://apps.apple.com/app/whataburger/id1141643627",
    playStore: "https://play.google.com/store/apps/details?id=com.whataburger.android",
  },
  "Wingstop": {
    website: "https://www.wingstop.com",
    appStore: "https://apps.apple.com/app/wingstop/id454719277",
    playStore: "https://play.google.com/store/apps/details?id=com.wingstop.android",
  },
  "Raising Cane's": {
    website: "https://www.raisingcanes.com",
    appStore: "https://apps.apple.com/app/raising-canes-chicken-fingers/id1530642656",
    playStore: "https://play.google.com/store/apps/details?id=com.raisingcanes.android",
  },
  "Zaxby's": {
    website: "https://www.zaxbys.com",
    appStore: "https://apps.apple.com/app/zaxbys/id480603264",
    playStore: "https://play.google.com/store/apps/details?id=com.zaxbys.android",
  },
  "Popeyes": {
    website: "https://www.popeyes.com",
  },
  "KFC": {
    website: "https://www.kfc.com",
    appStore: "https://apps.apple.com/app/kfc-order-delivery/id328506972",
    playStore: "https://play.google.com/store/apps/details?id=com.yum.kfc",
  },
  "Panera Bread": {
    website: "https://www.panerabread.com",
    appStore: "https://apps.apple.com/app/panera-bread/id692365393",
    playStore: "https://play.google.com/store/apps/details?id=com.panera.bread",
  },
  "Jimmy John's": {
    website: "https://www.jimmyjohns.com",
  },
  "Qdoba": {
    website: "https://www.qdoba.com",
  },
  "IHOP": {
    website: "https://www.ihop.com",
    appStore: "https://apps.apple.com/app/ihop/id572284095",
    playStore: "https://play.google.com/store/apps/details?id=com.ihop.android",
  },
  "Denny's": {
    website: "https://www.dennys.com",
    appStore: "https://apps.apple.com/app/dennys/id527548554",
    playStore: "https://play.google.com/store/apps/details?id=com.dennys.android",
  },
  "Applebee's": {
    website: "https://www.applebees.com",
  },
  "Chili's": {
    website: "https://www.chilis.com",
  },
  "Texas Roadhouse": {
    website: "https://www.texasroadhouse.com",
  },
  "Dairy Queen": {
    website: "https://www.dairyqueen.com",
    appStore: "https://apps.apple.com/app/dairy-queen-food-treats/id1359480496",
    playStore: "https://play.google.com/store/apps/details?id=com.dairyqueen.android",
  },
  "Krispy Kreme": {
    website: "https://www.krispykreme.com",
  },
  "Red Lobster": {
    website: "https://www.redlobster.com",
  },
  "P.F. Chang's": {
    website: "https://www.pfchangs.com",
  },
};

/**
 * Normalize restaurant name for lookup (handles apostrophe variants, trim).
 */
function normalizeName(name) {
  if (!name || typeof name !== "string") return "";
  return name
    .trim()
    .replace(/\u2019/g, "'")
    .replace(/\u2018/g, "'");
}

/**
 * Get links for a restaurant by exact or normalized name match.
 */
export function getRestaurantLinks(restaurantName) {
  if (!restaurantName) return null;
  const exact = RESTAURANT_LINKS[restaurantName];
  if (exact) return exact;
  const normalized = normalizeName(restaurantName);
  if (!normalized) return null;
  const key = Object.keys(RESTAURANT_LINKS).find(
    (k) => normalizeName(k) === normalized
  );
  return key ? RESTAURANT_LINKS[key] : null;
}

/**
 * Resolve brand domain from restaurant name (for logo URLs).
 */
function getBrandDomain(restaurantName) {
  if (!restaurantName) return "restaurant.com";
  const links = getRestaurantLinks(restaurantName);
  let domain = null;
  if (links?.website) {
    try {
      domain = new URL(links.website).hostname.replace(/^www\./, "");
    } catch (_) {}
  }
  if (!domain) {
    const slug = restaurantName.toLowerCase().replace(/[^a-z0-9]/g, "");
    domain = slug ? slug + ".com" : "restaurant.com";
  }
  return domain;
}

/** Clearbit logo API – high-res logos; returns 404 for unknown domains. */
const CLEARBIT_LOGO_BASE = "https://logo.clearbit.com/";

/** Google favicon – reliable fallback when Clearbit has no logo. */
const FAVICON_BASE = "https://www.google.com/s2/favicons?sz=128&domain=";

/**
 * Returns [primaryUrl, fallbackUrl] for brand logo. Try primary (Clearbit) first;
 * on 404/error use fallback (Google favicon) so logos stay sharp when available.
 */
export function getBrandLogoUrls(restaurantName) {
  const domain = getBrandDomain(restaurantName);
  const primary = CLEARBIT_LOGO_BASE + encodeURIComponent(domain);
  const fallback = FAVICON_BASE + encodeURIComponent(domain);
  return [primary, fallback];
}

/**
 * Single URL for backward compatibility (returns Clearbit first; use getBrandLogoUrls for fallback chain).
 */
export function getBrandLogoUrl(restaurantName) {
  const [primary] = getBrandLogoUrls(restaurantName);
  return primary;
}
